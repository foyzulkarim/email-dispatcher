services:

  # Backend server
  server:
    build:
      context: ./server
      target: dev
    container_name: email-dispatcher-server-dev
    restart: unless-stopped
    environment:
      NODE_ENV: development
      PORT: 4000
      # Connect to MongoDB running on host machine
      MONGODB_URI: mongodb://host.docker.internal:27017/email-dispatcher
      # Connect to RabbitMQ running on host machine
      RABBITMQ_URL: amqp://guest:guest@host.docker.internal:5672
      DEFAULT_FROM_EMAIL: noreply@yourdomain.com
      DEFAULT_FROM_NAME: Your Company Name
      TEST_EMAIL: your-test-email@example.com
      FORCE_DEBUG_MODE: true
    ports:
      - "4000:4000"
    volumes:
      - ./server:/app
      - /app/node_modules
      - ./server/mail-debug:/app/mail-debug
    # Note: develop block removed as it's not part of official Docker Compose spec

  # Frontend client
  client:
    build:
      context: ./client
      target: dev
    container_name: email-dispatcher-client-dev
    restart: unless-stopped
    environment:
      NODE_ENV: development
      VITE_API_URL: http://localhost:4000
    ports:
      - "3000:3000"
    volumes:
      - ./client:/app
      - /app/node_modules
    develop:
      watch:
        - action: sync
          path: ./client/src
          target: /app/src
          ignore:
            - node_modules/
        - action: rebuild
          path: ./client/package.json
